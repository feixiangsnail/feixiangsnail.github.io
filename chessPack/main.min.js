function loadPlayer(){that.player=new Player,that.player.initLead(),Laya.stage.addChild(that.player),console.log(that.sequence),1===that.sequence?(that.player1=new Player,that.player1.initOther(),Laya.stage.addChild(that.player1),that.player1.pos(620,540)):(that.player1=new Player,that.player1.initOther(),Laya.stage.addChild(that.player1),that.player1.pos(20,540)),drawLight(),that.countdown=new Countdown,Laya.stage.addChild(that.countdown),that.readyButton=new Buttontemp,that.readyButton.initReadyBtn(),Laya.stage.addChild(that.readyButton)}function readyGame(){ws.send("ready"),ws.onmessage=function(t){console.log(t.data),"start"===t.data&&(that.readyType=2)}}function onLoaded(){for(var t=10;t>0;t--)that.card=new Card,that.cardList.push(that.card),that.card.init(),Laya.stage.addChild(that.card),that.card.pos(345,580);setTimeout(function(){Laya.timer.frameLoop(3,that,loadPlayer1)},100),1===that.sequence?Laya.timer.frameLoop(1.5,that,loadPlayer2):Laya.timer.frameLoop(1.5,that,loadPlayer3)}function loadPlayer1(){if(2===that.readyType)if(console.log(111),0===that.cardType){var t=that.cardList[0];t.y+=65,t.x-=50,840===t.y&&(that.cardType+=1,Laya.timer.clear(that,loadPlayer1),Laya.timer.frameLoop(3,that,loadPlayer1))}else if(1===that.cardType){var a=that.cardList[1];a.y+=65,a.x-=25,840===a.y&&(that.cardType+=1,Laya.timer.clear(that,loadPlayer1),Laya.timer.frameLoop(3,that,loadPlayer1))}else if(2===that.cardType){var e=that.cardList[2];e.y+=65,840===e.y&&(that.cardType+=1,Laya.timer.clear(that,loadPlayer1),Laya.timer.frameLoop(3,that,loadPlayer1))}else if(3===that.cardType){var i=that.cardList[3];i.y+=65,i.x+=25,840===i.y&&(that.cardType+=1,Laya.timer.clear(that,loadPlayer1),Laya.timer.frameLoop(3,that,loadPlayer1))}else if(4===that.cardType){var n=that.cardList[4];n.y+=65,n.x+=50,840===n.y&&(Laya.timer.clear(that,loadPlayer1),that.dealType=!0)}that.dealType&&(showRobButton(),setTimeout(function(){openWebsocket()},300),that.countdownText=new Laya.Text,that.countdownNum=8,that.countdownText.color="#ffffff",that.countdownText.fontSize=28,that.countdownText.x="367",that.countdownText.y="575",that.countdownText.text=that.countdownNum,Laya.stage.addChild(that.countdownText),that.timer=setInterval(function(){that.countdownNum-=1,that.countdownText.text=that.countdownNum,0===that.countdownNum&&(0===that.robType&&norob(),clearInt(),console.log(111))},1e3))}function clearInt(){clearInterval(that.timer),that.countdown.visible=!1,that.countdownText.visible=!1,that.countdownNum=8}function loadPlayer2(){if(2===that.readyType)if(0===that.cardType2){var t=that.cardList[5];t.x+=25,console.log(t.x),545===t.x&&(that.cardType2+=1,Laya.timer.clear(that,loadPlayer2),Laya.timer.frameLoop(1.5,that,loadPlayer2))}else if(1===that.cardType2){var a=that.cardList[6];a.x+=20,525===a.x&&(that.cardType2+=1,Laya.timer.clear(that,loadPlayer2),Laya.timer.frameLoop(1.5,that,loadPlayer2))}else if(2===that.cardType2){var e=that.cardList[7];e.x+=20,505===e.x&&(that.cardType2+=1,Laya.timer.clear(that,loadPlayer2),Laya.timer.frameLoop(1.5,that,loadPlayer2))}else if(3===that.cardType2){var i=that.cardList[8];i.x+=20,485===i.x&&(that.cardType2+=1,Laya.timer.clear(that,loadPlayer2),Laya.timer.frameLoop(1.5,that,loadPlayer2))}else if(4===that.cardType2){var n=that.cardList[9];n.x+=20,465===n.x&&Laya.timer.clear(that,loadPlayer2)}}function loadPlayer3(){if(2===that.readyType)if(0===that.cardType3){var t=that.cardList[5];t.x-=25,console.log(t.x),145===t.x&&(that.cardType3+=1,Laya.timer.clear(that,loadPlayer3),Laya.timer.frameLoop(1.5,that,loadPlayer3))}else if(1===that.cardType3){var a=that.cardList[6];a.x-=20,165===a.x&&(that.cardType3+=1,Laya.timer.clear(that,loadPlayer3),Laya.timer.frameLoop(1.5,that,loadPlayer3))}else if(2===that.cardType3){var e=that.cardList[7];e.x-=20,185===e.x&&(that.cardType3+=1,Laya.timer.clear(that,loadPlayer3),Laya.timer.frameLoop(1.5,that,loadPlayer3))}else if(3===that.cardType3){var i=that.cardList[8];i.x-=20,205===i.x&&(that.cardType3+=1,Laya.timer.clear(that,loadPlayer3),Laya.timer.frameLoop(1.5,that,loadPlayer3))}else if(4===that.cardType3){var n=that.cardList[9];n.x-=20,225===n.x&&Laya.timer.clear(that,loadPlayer3)}}function showRobButton(){that.robButton=new Buttontemp,that.robButton.initRob(),Laya.stage.addChild(that.robButton),that.norobButton=new Buttontemp,that.norobButton.initNorob(),Laya.stage.addChild(that.norobButton)}function openWebsocket(){ws.send("draw"),ws.onmessage=function(t){var a=JSON.parse(t.data);initOpenCard(a)}}function initOpenCard(t){that.cardList[0].visible=!1,that.cardList[1].visible=!1,that.cardList[2].visible=!1,that.cardAction1=new Card,that.cardAction1.initAnimation(t[0],145,840),that.cardAction1.pos(145,830),Laya.stage.addChild(that.cardAction1),that.cardAction2=new Card,that.cardAction2.initAnimation(t[1],245,840),that.cardAction2.pos(245,830),Laya.stage.addChild(that.cardAction2),that.cardAction3=new Card,that.cardAction3.initAnimation(t[2],345,840),that.cardAction3.pos(345,830),Laya.stage.addChild(that.cardAction3)}function drawLight(){that.light=new Light,that.light.initLead(),Laya.stage.addChild(that.light),that.light.pos(315,950),that.light.visible=!1,that.light1=new Light,that.light1.initOther(),Laya.stage.addChild(that.light1),that.light1.pos(620,540),that.light1.visible=!1,that.light2=new Light,that.light2.initOther(),Laya.stage.addChild(that.light2),that.light2.pos(20,540),that.light2.visible=!1}function lightAction(){that.countdown.visible=!1,that.countdownText.visible=!1,that.robButton.removeSelf(),that.norobButton.removeSelf(),clearInterval(that.timer),that.lightTimer=setInterval(function(){that.lightStep+=1,that.lightStep%2===1?(that.light.visible=!0,1===that.sequence?that.light1.visible=!1:that.light2.visible=!1):(1===that.sequence?that.light1.visible=!0:that.light2.visible=!0,that.light.visible=!1),console.log(that.lightStep),console.log(that.lightNum),that.lightStep===Number(that.lightNum)&&(clearInterval(that.lightTimer),that.countdownNum=8,that.countdownText.text=that.countdownNum,that.countdown.visible=!0,that.countdownText.visible=!0,that.timer=setInterval(function(){that.countdownNum-=1,that.countdownText.text=that.countdownNum,0===that.countdownNum&&clearInt()},1e3),"12"===that.lightNum?stakeMultiple():idleHome())},150)}function rob(){that.robButton.removeSelf(),that.norobButton.removeSelf(),that.robType=1;var t={name:that.username,msg:"rob"};ws.send(JSON.stringify(t)),ws.onmessage=function(t){console.log(t.data),"11"===t.data||"12"===t.data?(that.lightNum=t.data,lightAction()):t.data===that.username?(that.light.visible=!0,idleHome()):(stakeMultiple(),1===that.sequence?that.light1.visible=!0:that.light2.visible=!0)}}function norob(){that.robButton.removeSelf(),that.norobButton.removeSelf(),that.robType=1;var t={name:that.username,msg:"norob"};ws.send(JSON.stringify(t)),ws.onmessage=function(t){console.log(t.data),"11"===t.data||"12"===t.data?(that.lightNum=t.data,lightAction()):t.data===that.username?(that.light.visible=!0,idleHome()):(stakeMultiple(),1===that.sequence?that.light1.visible=!0:that.light2.visible=!0)}}function stakeMultiple(){for(var t=0;4>t;t++)that.stake=new Stake,that.stakeList.push(that.stake),Laya.stage.addChild(that.stake);that.stakeList[0].init(1),that.stakeList[0].pos(145,760),that.stakeList[1].init(2),that.stakeList[1].pos(265,760),that.stakeList[2].init(4),that.stakeList[2].pos(385,760),that.stakeList[3].init(5),that.stakeList[3].pos(505,760)}function idleHome(){that.idleText=new Laya.Text,that.idleText.color="#ffffff",that.idleText.fontSize=22,that.idleText.x="310",that.idleText.y="800",that.idleText.text="等待闲家下注",Laya.stage.addChild(idleText)}function pour(t){console.log(t);var a={name:that.username,number:t,type:"rob"};ws.send(JSON.stringify(a)),ws.onmessage=function(t){console.log(t.data);var a=JSON.parse(t.data);a.name===that.username?(createMutiply(a.number),that.mutiply.pos(440,970)):1===that.sequence?(createMutiply(a.number),that.mutiply.pos(580,530)):(createMutiply(a.number),that.mutiply.pos(140,530)),that.stakeList.forEach(function(t){t.removeSelf()}),clearInt()}}function nopour(){var t={type:"rob"};ws.send(JSON.stringify(t)),ws.onmessage=function(t){console.log(t.data);var a=JSON.parse(t.data);a.name===that.username?(createMutiply(a.number),that.mutiply.pos(440,970)):1===that.sequence?(createMutiply(a.number),that.mutiply.pos(580,530)):(createMutiply(a.number),that.mutiply.pos(140,530)),clearInt()}}function createMutiply(t){that.mutiply=new Mutiply,that.mutiply.init(t),Laya.stage.addChild(that.mutiply)}var Mutiply=function(t){function a(){a.super(this)}Laya.class(a,"Mutiply",t);var e=a.prototype;return e.init=function(t){this.srcNum=t,this.mutiply=new Laya.Sprite,this.mutiply.loadImage("chess/X-"+this.srcNum+".png",0,0,34,34),this.addChild(this.mutiply)},a}(Laya.Sprite),Stake=function(t){function a(){a.super(this)}Laya.class(a,"Stake",t);var e=a.prototype;return e.init=function(t){this.srcNum=t,this.stake=new Laya.Sprite,this.loadImage(),this.addChild(this.stake),this.stake.on(Laya.Event.CLICK,this,function(){pour(this.srcNum)})},e.loadImage=function(){this.stake.loadImage("chess/multiple"+this.srcNum+".png",0,0,103,52)},a}(Laya.Sprite),Light=function(t){function a(){a.super(this)}Laya.class(a,"Light",t);var e=a.prototype;return e.initLead=function(){this.light=new Laya.Sprite,this.light.loadImage("chess/light.png",0,0,126,196),this.addChild(this.light)},e.initOther=function(){this.light=new Laya.Sprite,this.light.loadImage("chess/light.png",0,0,111,172),this.addChild(this.light)},a}(Laya.Sprite),Buttontemp=function(t){function a(){a.super(this)}Laya.class(a,"Buttontemp",t);var e=a.prototype;return e.initReadyBtn=function(){this.readyButton=new Laya.Sprite,this.readyButton.loadImage("chess/readyButton.png",0,0,178,58),this.addChild(this.readyButton),this.readyButton.pos(290,880),this.readyButton.on(Laya.Event.CLICK,this,function(){readyGame(),this.readyButton.removeSelf()})},e.initRob=function(){this.robButton=new Laya.Sprite,this.robButton.loadImage("chess/rob.png",0,0,138,54),this.addChild(this.robButton),this.robButton.pos(220,760),this.robButton.on(Laya.Event.CLICK,this,function(){rob()})},e.initNorob=function(){this.norobButton=new Laya.Sprite,this.norobButton.loadImage("chess/norob.png",0,0,138,54),this.addChild(this.norobButton),this.norobButton.pos(390,760),this.norobButton.on(Laya.Event.CLICK,this,function(){norob()})},a}(Laya.Sprite),Countdown=function(t){function a(){a.super(this),this.countdown=new Laya.Sprite,this.countdown.loadImage("chess/bull_clock.png"),this.addChild(this.countdown),this.countdown.pos(345,560)}return Laya.class(a,"Countdown",t),a}(Laya.Sprite),Player=function(t){function a(){a.super(this)}Laya.class(a,"Player",t);var e=a.prototype;return e.initLead=function(){this.player=new Laya.Sprite,this.player.loadImage("chess/player.png",0,0,126,196),this.addChild(this.player),this.player.pos(315,950)},e.initOther=function(){this.player=new Laya.Sprite,this.player.loadImage("chess/player.png",0,0,111,172),this.addChild(this.player)},a}(Laya.Sprite),Card=function(t){function a(){a.super(this)}Laya.class(a,"Card",t);var e=a.prototype;return e.init=function(){this.card=new Laya.Sprite,this.card.loadImage("cards/backcard.png",0,0,64.5,96),this.addChild(this.card)},e.initAnimation=function(t,a,e){this.num=t,this.x=a,this.y=e,Laya.Animation.createFrames(["cards/animation_2.png","cards/animation_3.png","cards/animation_4.png","cards/animation_5.png","cards/animation_6.png","cards/animation_7.png"],"card"),this.body=new Laya.Animation,this.body.interval=30,this.addChild(this.body),this.body.on(Laya.Event.COMPLETE,this,this.onPlayComplete),this.playAction("card")},e.onPlayComplete=function(){console.log(111),this.body.removeSelf(),this.changeImg(this.num)},e.playAction=function(t){this.body.play(0,!1,t)},e.changeImg=function(t){this.card=new Laya.Sprite,this.card.loadImage("cards/"+t+".png",0,0,64.5,96),this.addChild(this.card),this.pos(Number(this.x),Number(this.y)+10)},a}(Laya.Sprite),Background=function(t){function a(){a.super(this),this.background=new Laya.Sprite,this.background.loadImage("chess/table.jpg"),this.addChild(this.background)}return Laya.class(a,"Background",t),a}(Laya.Sprite);Laya.init(750,1216,Laya.WebGL),Laya.stage.scaleMode="showall",Laya.stage.alignH="center",Laya.stage.alighW="center";var that=this;that.table=new Background,Laya.stage.addChild(that.table),that.username="Tony",that.cardType=0,that.cardType2=0,that.cardType3=0,that.readyType=1,that.lightNum=11,that.stakeList=[],that.sequence=1,that.lightStep=0,that.dealType=!1,that.cardList=[],that.robType=0,that.norobType=0;var ws=new WebSocket("ws://10.96.84.105:8181");ws.onopen=function(){console.log("connection!"),ws.onmessage=function(t){console.log(t.data),that.sequence="front"===t.data?1:2,Laya.loader.load("res/atlas/chess.atlas",Laya.Handler.create(that,loadPlayer),null,Laya.Loader.ATLAS),Laya.loader.load("res/atlas/cards.atlas",Laya.Handler.create(that,onLoaded),null,Laya.Loader.ATLAS)}};